（设计完成）【衣食住行】出品发布v1.1.1: 需要解决的问题：场景举例：库存有1份糖醋排骨（生产规则为需要50克排骨）。目前，在制定出品计划时，糖醋排骨的计划份数为10份，系统自动计算所需排骨=50克*10份=500克，而不会扣除现有库存。会导致采购按500克进行采购，与实际应采购的份数（50克*9份=450克）不一样。当计划份数和库存数量足够大时，会给餐厅造成损失。变动：出品计划表中新增“现有库存”字段，所需原料数量=（计划份数-现有库存）*单份所需原料数量具体需求见  
【衣食住行】出品发布2.0: 背景：餐厅会在不同时间段做不同出品计划，以便顾客可以在不同时间段进行选择，当前，需要餐厅出多个出品计划，且不便采购统计采购数据。需求优化，在一个出品发布中满足这些需求采购部需要将一些物资放在一起，以便统一给某个供应商，比如肉类，豆制品，蔬菜采购部在物资入库后，需要按采购需求，将物资发送给不同的档口但需要注意的一个场景是：厨房给物资部第二天的出品计划，但如果现有库存充足，但晚餐时间段可能会消耗库存后，没有足够库存供第二天的出品，此时采购已经来不及了需要有发起提前生产的功能基于以上搜集到的场景，2.0版出品发布的功能，如下：在一个出品发布中，包含不同时间段的菜品，并且菜品只在该时间段能在盟客网被顾客选择采购需求表需要可以将表格信息进行拖动排序需求购量需要重新整理计算方案：提前发起生产的功能：有中级物资权限的人可以操作，发起生产后，产品负责人会收到任务，并进行制作11月22日内部评审意见：“采购部需要将一些物资放在一起，以便统一给某个供应商，比如肉类，豆制品，蔬菜”让采购部将官方拉入发布，不要走原来的导出Excel程序“采购部在物资入库后，需要按采购需求，将物资发送给不同的档口”与供需对接后能实现需求： 视觉：  
【待完善】发布-发布内容中表格的可编辑性还不够: 问题描述：在发布内容中，插入表格后，无法改变表格的宽度，无法为表格中的内容添加序号。感觉不太方便。 
11月13日餐厅试用反馈: 试用时间：13:00-16:30参与者：殷豪、餐厅众人、方燕玉反馈问题汇总：（提bug）出品发布的客方只能选择事务内，需要与普通发布的客方选择范围保持一致（提bug）在出品发布中，添加产品时，选择角标“全部”时，反而看不见全部物资，另外需要将重复的角标名合并（已提测）（需求优化）在出品发布的需求表单中，物资部需要查看到将每个原料发送给哪个档口负责人；出品计划中能直接编辑生产复制人（需求优化）在编辑生产规则中，需要搜索角色的功能（提bug）在发十几个物资时，卡住了，有时报“普通异常”（已提测）（需求优化）餐厅会在不同时间段做不同出品计划，以便顾客可以在不同时间段进行选择，当前，需要餐厅出多个出品计划，且不便采购统计采购数据。需求优化，在一个出品发布中满足这些需求（需求优化）档口负责人会分几班，涉及角色更换担任者（设计优化）点餐界面，字体颜色相对于当前的银豹，暗淡很多，影响视力弱的用户点餐
地址页问题汇总及解决方案: 一、配送地址输入错误的提示规范问题描述：联系姓名未输入的弹窗提示不友好解决方案： 二、编辑地址时输入光标位置优化问题描述：编辑地址时，点击门牌号、联系姓名、电话三行的输入框空白位置，光标默认在字符最前面；解决方案： 三、地址详情页的文案和颜色优化问题描述：实现页面和设计图有多处文案、颜色、位置上的不同解决方案：遵循设计图规范进行优化 
【衣食住行】代售其他店的商品: 1.背景：金陵风尚店需要代售simutea的菜品，主要有两个场景：1）下午茶在金陵风尚店提供，有SIMU TEA制作 2）晚宴点菜的时候果汁饮料是由SIMUTEA提供在这个需求没上线前，餐厅临时的解决方案：金陵风尚店内放置simu tea点餐二维码，客人点单后，simu tea制作或将成品拿到楼下风尚店内。2.目标：顾客可以在一个订单中同时选择金陵风尚店的菜品和simutea的菜品。在2019年5月17日回头看会议上明确：目前由于我们没有支付牌照，无法实现顾客一次支付，我们平台分账给各门店的信息。目前可行的方案是：顾客（C）付钱给金陵风尚店(J)，订单中所有物资均从J发送给C，J和C实现平账；C点的关于SIMUTEA（S）的餐点，在制作完成后，需要有S发送给J，两家店通过内部分账达成平账。3.代售逻辑 4.涉及的模块：衣食住行-出品发布衣食住行-订单发布衣食住行-菜单衣食住行-盟客币发放配置（其他事务点餐也能送盟客币，需要明确满抵能不能用）主系统-物资维度的功能主系统-交易模块（还有经营报表）5.功能说明：5.1功能简述：关联出品发布用户故事：商家可以在某个出品计划持续时间段内关联另一个商家的出品发布，以便售卖另一商家的商品。功能详述：优先级：高平台：WEB描述：(假如金陵风尚店的出品发布代卖simutea的出品，为下文表述方便，simutea（商家1）的出品发布表示为出品发布1，金陵风尚店（商家1’）的出品发布表示为出品发布1’)可以在添加其他事务进行中的出品发布选择范围：对本事务公开的出品发布才能选中；只能选择进行中且计划时间没结束，或者未开始的出品发布出品发布1’中对应的出品时间段取“商家计划持续时间”和“被关联出品发布的计划持续时间”重叠的部分出品的分类及分类排序遵循被关联商家的配置可以选择有效时间段内的几个物资，也可以全选，若都不选，则认为不关联。不可另外配置被关联发布的信息，被关联发布的信息更新后，这边同步更新被添加的出品发布1的产品，在出品发布1’的“出品计划”中，计划份数同步更新，订单份数只记录本事务的订单情况，显示负责人，和生产规则（同盟内显示生产规则，不同盟不显示生产规则）被添加的出品发布1的产品，不算入出品发布1’的“采购需求”中被添加的出品发布1的产品，在出品发布1’的生产实况表中：不可以“预生产”已售数量：只记录本事务的已售信息计划数量：与出品发布1中的计划数量同步库存：与出品发布1的库存同步可点数量：与出品发布1的库存同步  4.2功能简述：查看出品发布用户故事：配置了出品发布的商家，以及关联其他事务的出品发布的商家都可以查看出品发布，两边查看的信息会有不同。功能详述：优先级：高平台：WEB描述：出品发布1'可以查看出品发布1的菜品信息出品发布1可以查看自己被哪些出品发布1’关联了当出品发布1失效时，系统需要提醒会影响到哪些其他出品发布  4.3功能简述：查看订单发布用户故事：商家1’需要查看订单发布。功能详述：优先级：高平台：WEB描述：顾客在商家1’中点了商家1的商品后，对应菜品的制作环节的负责人需要作为订单的官方商家1‘的订单，在商家1中会作为协作发布店内就餐：商家1制作-制作任务提交后，商家1进行上菜，上菜任务提交后，物资发送到商家1’的事务公共物资库中，然后再从商家1’的事务公共物资库自动发送给顾客的角色库。外卖点餐：商家1制作-制作任务提交后，物资发送到商家1‘事务公共物资库中，待订单中所有菜品均制作完成，商家1’触发配送任务。用户只需向服务发起的事务支付订单。  4.4功能简述：查看菜单用户故事：顾客在商家1’可以查看到菜单。功能详述：优先级：高平台：WEB描述： 4.6功能简述：盟客币发放和使用逻辑用户故事：顾客在点单中可以获得盟客币，并且在支付时，可以使用盟客币进行抵扣，需要分清哪个商家可以发放和获得盟客币。功能详述：优先级：高平台：WEB描述：(假如金陵风尚店的出品发布代卖simutea的出品，为下文表述方便，simutea（商家1）的出品发布表示为出品发布1，金陵风尚店（商家1’）的出品发布表示为出品发布1’)如果顾客在商家1’中点商家1的产品：盟客币发放逻辑遵守商家1的配置逻辑，顾客点菜成功后，盟客币由商家1发放顾客在支付时，分别计算商家1和商家1’的支付金额，分别遵循各商家配置的抵扣逻辑如果顾客在商家1中点餐，遵循正常逻辑不变。4.8功能简述：交易模块用户故事：功能详述：优先级：高平台：WEB描述：从商家1发出的物资，记录在商家1的交易数据中；从商家1‘发出的物资，记录在商家1’的交易数据中。资金的记录逻辑也一样。 档口营业表：商家1会将物资发送至商家1’的事务公共物资库，因此事务公开物资库也会出现在档口营业报表的统计数据中商家1的档口营业报表中记录成本价。每日销售报表：商家1的物资，会进入商家1’的销售统计中，交易金额为物资售价之和商家1的每日销售报表中记录成本价。新增代售情况表 
【衣食住行】出品发布3.1-预订引发的出品发布优化: 一、背景：当顾客下预订类型的订单后，商家有必要在出品发布中了解该情况。二、场景：1. 商家如何在出品发布中查看已预订的订单；2.如果商家修改了出品发布的时间，如何处理;3. 如果商家修改了出品发布的菜品，如何处理；4. 查看出品发布的采购需求表：在出品时间段已结束时，不再计算采购需求；提醒商家在经营时间段内有物资会自动核销/报废，会影响经营；5. 查看生产实况：售出份数之前的定义为：已完成上菜任务的份数，但此版本需要考虑已预订的情况；将预生产与主系统的生产功能进行映射。6.查看出品发布的动态三、需求：3.0出品发布状态：进行中的出品发布，可进行的操作：操作权限：发布创建者，发布的官方，本事务发布的中级权限，父事务发布的高级权限，盟内发布的超级权限编辑标题失效发布（有进行中的订单和已完成的订单时，不允许失效发布）修改公开性发布详情中：编辑出品时间段，编辑出品计划表提交出品计划编辑标签、评论、参与者、会话、任务、子发布的操作同主系统的发布进行中的出品发布，可查看的内容：发布标题发布创建者发布的更新时间出品计划的时间段出品计划表、采购需求表、生产实况表标签、评论、参与者、会话、任务、子发布、动态的查看同主系统的发布已完成的出品发布，可进行的操作：转至动态重新打开修改公开性发布详情：采购需求表中生成供给发布，生产实况表中进行预生产编辑标签、评论、参与者、会话、任务、子发布的操作同主系统的发布已完成的出品发布，可查看的内容：发布标题发布创建者发布的更新时间出品计划表、采购需求表、生产实况表标签、评论、参与者、会话、任务、子发布、动态的查看同主系统的发布再次编辑进行中的出品发布，可进行的操作：编辑出品时间段，见3.2功能名称：修改出品发布的时间；编辑出品计划表，见3.1功能名称：从出品发布中查看已预订的订单；3.3功能名称：修改出品发布的菜品“提交出品计划”的文案变为“更新出品计划”其余同进行中的出品发布再次编辑进行中的出品发布，可查看的内容：同进行中的出品发布已失效的出品发布，可进行的操作：恢复发布3.1 功能名称：从出品发布中查看已预订的订单用户故事：用户需要在出品发布中查看，该出品是否有已预订的订单。如果商家的出品计划有变化，用户需要快速跳转到已预订的订单中做相应的处理。功能详述：优先级：高平台：web app功能描述：“预订份数”取代“现有库存”；“生产规则”代替“所需原料”。预订份数指：打开该出品发布时，预订该菜品的总份数；如果在查看出品发布时，有顾客进行预订或者取消预订，那么需要同步更新预订份数。“生产规则”：选取生产规则的名称，想要查看完成的生产规则，可通过点击“更换生产规则”按钮，查看。原有版本“所需原料”不能完全显示原料信息。如果半成品选择直接购买，在“生产规则”栏显示“采购”。点击“查看预订”和每道菜的预订份数时，自动实现发布筛选：类型：预订状态：进行中起止时间：默认出品发布日期如果从“查看预订”进入，搜索值为MMDD；如果从每道菜的预订份数进入，默认搜索：该菜品的名称。在出品时间段开始后，“预订份数”字段改为统计“订单份数”-改为“订单份数”需要主系统配合的交互优化：在用户退出发布详情时，记住当时发布的位置，不要置顶还原。这样有助于服务员在退出发布详情时，查看。 3.2功能名称：修改出品发布的时间在进行中且没有订单时，出品发布时间可任意修改；在有订单后，出品发布时间段的起点，只可往前调，不能往后调；终点只可往后调，不能往前调。3.3功能名称：修改出品发布的菜品用户故事：用户对出品发布的菜品信息做临时调整，以便与餐厅营业情况符合。在删除菜品时，如果已有菜品被顾客预约，需要将取消完已有订单的菜品后才能删除菜品；不影响新增菜品。功能详述：优先级：高平台：web app功能描述：出品时间没开始前：编辑计划份数时，计划份数不能少于已被预约数量在编辑物资时，不能删除已被预约的物资，并提醒用户“已有顾客预约该菜品，取消预约后才可删除”出品时间开始后：编辑计划份数时，计划份数不能少于已有订单的数量在编辑物资时，不能删除已有订单的物资，并提醒用户”该物资已存在订单中，不能删，否则会影响交易数据统计“交互说明：已选产品处显示所有已选产品（而不是本次选的产品）；新添加的产品加在上面，如果有预约的要做一个标记；新选商品置顶，并要求用户输入份数（份数默认1）； 3.4功能名称：查看采购需求表物资名称： 显示的范围：最原始的原料名称，若产品的原料中包括半成品，需要选取半成品的原料（目前只支持两级，成品-半成品）；排序：按需求购量排序，数值大的排在前面。若数值一样大，按拼音字母先后顺序排序。在出品时间段结束后，不再计算该时间段内的采购。查看采购需求表时，如果在出品日期内，已有出品时间段结束，那么采购需求不再计算已结束时间段内的需求购量；查看采购需求表时，如果在出品日期内，有出品时间段正在进行中，那么采购需求需要在之前算法的基础上进一步减去当前时间段内已发送给顾客的数量（已接收和未接收的数量都算）；查看采购需求表时，如果出品日期内，所有出品时间段都结束，那么不查看采购需求表。查看采购需求表时，如果在“查看的时间点-出品时间最后一个时间段的结束时间点前”存在物资会自动核销/报废，需要有提醒，展示的信息包括：所在库-到期时间-数量3.5功能名称：查看生产实况表交互说明：打开生产实况表时，默认展开当前营业时间段内的信息，其他时间段内信息收起。在当前营业时间段内，查看生产实况表，可查看以下内容：计划份数：出品计划份数选取出品计划表中的计划份数已售份数：售出份数（当前时间段内已上菜+未上菜的份数）可点份数：min（计划份数-已售份数，库存-锁定）（如果库存不足导致可点份数较少，要出提示）库存份数：当前物资库中物资库存+原料可生产的库存（锁定：被点，但没有发送的物资，包括当前时间段内被顾客下单但未发送的物资及包含该物资的复合物资，以及当天剩余时间段内被预订的物资）采购到的原料优先算为较早时间段内的出品库存，比如采购的绿豆芽可供中午的，但晚上不足，那只在晚餐提醒原料不足。假如绿豆芽今天午餐单点计划出5份，套餐中包含5份，晚饭包含5份，共需15份。如果只准备了14份原料，只在晚餐的绿豆芽处显示库存不足导致可点数量较少。如果午餐只卖了9份，可以匀一份到晚餐，在午餐结束后，重新计算晚餐库存，此时绿豆芽数量是足够的，不再报可点数量较少的提醒。可以下载生产实况表，需要查看以下信息：时间段/菜品名称/计划份数/实际销售数量当营业时间段结束后，查看该时间段内的生产实况表，可查看以下内容：不展示可点，库存信息套餐不展示所含普通物资信息没有预生产入口。 预生产：主系统生产后，还需要填写备注，目前不进行备注填写。主系统的“生产”，变为“创建生产任务”。创建完成后，对应菜品的负责人可以收到预生产任务。  3.6功能名称：查看出品发布的动态系统记录的动态包括任务的创建、删除、修改子发布的创建、删除、修改发布的编辑记录发布的动态按照时间顺序从新到旧排列          
发布富文本存在的问题汇总-长期: 请写明问题，修改备注提出人，不然没法二次确认1. 新行输入“”时会出现““”（mac的默认拼音输入法在第一行的最开始直接双引号的时候有问题，要么不再顶头直接双引号，要么用搜狗三方输入法都能解决，直接解决问题太过麻烦）2.表格中复制一行文字，粘贴到另一单元格会变成三行，如下 3. 标题复制粘贴只能保留加粗字号，不能保留标题样式（临时解决方案，拷贝不止标题这一行，需要重写标题的组件，不能用draftjs的，因为拷贝单行标题的时候带不了标题的header信息，没法解析处理成对应的标题样式）4.表格列数选择过多（超过7）的情况下，可能右键不能出现弹窗5.表格出现横向滚动时，滚动条不能隐藏6.表格复制粘贴出来不好使（临时方案从A,B标题那位置就开始复制，或者在预览发布的地方复制表格更方便，后续需求补一下表格的浮窗，单独提供复制按钮吧，参考雨雀）7.发布内部复制粘贴带block格式内容会丢失样式（应该是自定义了复制外链解决图片粘贴问题引入）8.选中后点击删除线、下划线，选中区间会丢失（需要重写按钮的弹窗，antd的select必然会导致失焦）9. 全屏编辑时没有保存选项10.有序无序列表和图片一起复制的时候，图片会被解析成json字符串，单独拷贝图片没有问题11. 列表选项，没有回到上一级列表的键盘选项（空行回车或者删除键 国际惯例shift+tab）12.图片下插入有序无序列表的时候删除列表，会导致光标在当前列表内，但是会选中图片，再次输入图片会丢失
【衣食住行】第1周需求: 【出品计划】目标：实现“按餐厅实际库存进行出品”的功能  需求：填写出品计划表后，“提交出品计划”时，需要用户同时创建采购任务任务的名称：采购-出品发布的标题任务负责人：选择范围为出品发布的官客方开始时间：此刻截止时间：出品计划日期前一天的23：59其余数据同主系统创建任务的数据。在截止日期前一天的18点后，若采购任务没完成，每隔一小时推送任务给任务的负责人和协作者生产实况表的数据如下：计划份数：出品计划表中填写的数量（A）已售份数（实时计算）：在菜单中已点的数量之和(D)，包括已发送给顾客的(B)和已点但未发送给顾客的(C)库存可售份数（G）（实时计算）：实际库存+可生产+生产中实时可点份数：min(A-D，G-D)，可点份数可以修改，修改范围为[0,当前值]，即顾客端可以查看到的剩余数量对于套餐和零点共有一个菜品，以及两个菜品共用一道原料，同样使用实时份数取最小值的原则预生产份数要小于等于可生产数量 在到达营业时间后，“出品计划”不能再编辑。同时校验各产品原料数量，当原料不足时需要提醒，页面上提醒“XX原料不足，可点数量小于计划数量”。   【h5复合物资详情】           在订单中，点击菜品显示菜品的物资模板，复合物资的物资模板：      
【需求迭代】-出品发布: 问题1：用户在使用出品发布时，不知道将公开性更改为“公开”后，盟客网才能在对应时间段内查看到菜单。解决方案：在创建发布时，提示用户“公开性”的影响。问题2:出品计划通常是一天，可以考虑设置默认时间，减少用户输入。解决方案：默认时间为：配置出品计划的T+1  0:00-23:59。相关需求见  
【衣食住行】出品发布3.0: 背景：1.出品发布-出品计划表：当前如果菜品需要通过半成品生产而来，无法选择半成品的生产规则。需要有半成品生产规则的选择功能。会根据菜品情况，有时候需要直接购买半成品，有时候需要买半成品的原料再加工为半成品；2.出品发布-采购需求表：在计划时间内查看，即使采购任务完成，但随着顾客下单，会不断消耗库存，需求购量会显示不足，但此时已经不需要进行采购了；在计划时间后查看，比如如果早餐和晚餐都需要蘑菇，在下午检查库存时，由于早餐消耗了蘑菇，系统会自动显示还需采购蘑菇，但其实现有库存的量已经够用于晚餐；同时需要考虑：当出品计划发生更改后，如何通知采购人员采购需求发生了变化。2019年2月18日，在周一例会上确认，在移动端编辑出品发布，需要处理的信息很多，建议在web端实现这个功能，因此暂时不推动移动端编辑出品发布的功能。解决方案：  1.出品发布-出品计划表在添加产品时，新增半成品的生产规则操作入口；      2.出品发布-采购需求表在当前需求购量的算法基础上，减去已售的数量。
[需求更新]抽奖发布模块需求及设计: 迭代版本说明 抽奖发布1.0：12.29更新：随机抽奖 ：当奖品为资金时，在确认添加的时候检验，选择账户余额不足的时候，则提示“余额不足”；当奖品为物资时，选择的时候只能选择已有的物资，若选择之后数量发生变更导致不足，则提示“库存不足”；统一随机抽奖中的发放类型名称为“拼手气”红包；摇一摇抽奖：添加团队奖励设置的时候，默认显示发送账户；添加团队奖励设置的时候，奖励团队数量<=团队数量；抽奖结果页选择获奖用户时，显示每个获奖用户的次数；同名次的处理方案由开发进行处理；抽奖结果页中奖规则介绍中，改为阿拉伯数字；抽奖发布：增加活动列表为0的设计图；增加摇一摇抽奖获奖团队的名称；增加平分奖金时每一个获奖者的获奖金额，奖品类型为物资时，不显示每个获奖者的奖品；增加活动列表中进行中的活动的入口按钮；1.9更新：默认收款账户为个人角色的私密资金库，默认接受物资库为个人角色的私密物资库；金额的设置范围统一为小数点后两位；摇一摇活动中配置的获奖人数为n，在点击立即开奖之后，会默认选中前n名为默认获奖用户；微信扫描抽奖发布的分享二维码，走事务分享的流程，见   ；更新抽奖活动状态图，及web端和移动端可操作内容，见   ；摇一摇抽奖中阵营名称长度为1~10个字符；1.10更新：移动端摇一摇进行时，禁用关闭按钮；web端摇一摇进行时，禁用重新开始按钮；抽奖发布中，只有官方可以拉其他角色进入发布，客方和高权限角色不可以拉其他角色进入发布；奖品为物资时的份数为整数；抽奖发布1.1视频连线：1.16更新：连线对方未响应或者拒绝连线时，该连线方自动从连线区域中消失，toast提示：“xxx拒绝了你的连线”；“xxx未响应”；参考文档：抽奖视频连线相关需求文档：  抽奖视频 连线交互原型图：  抽奖发布相关设计文档：         
【需求更新】发布评论支持置顶功能: 变更记录 一、目的官方可以控制评论区的置顶内容，来向其他人说明一些反复说明的问题；客方反馈的有关发布的问题，官方可以置顶并回复给出解答；客方可以置顶自己的评论，以期快速得到官方的回复；二、具体应用场景在某公司产品经理的招聘发布中，有前来面试的客方评论面试的体验以及对公司的印象等等，官方精选出优质评论进行置顶；在某个bug反馈的发布中，反馈问题的客方发现反馈的问题没有得到重视，将自己的问题发表在评论区并置顶，来引起官方的重视；客方置顶评论后，可一眼看到自己想问的问题是否被提出，官方是否已有回复；三、功能描述简述：发布评论支持置顶功能涉众：评论可置顶操作者：发布官客方以及发布高权限者评论可置顶范围：一级评论评论查看范围：发布的所有可见用户（由发布可见性决定）需求描述：支持发布官方以及事务高权限者将某一条评论置顶，置顶后该评论及其回复会保持在评论列表的最上面；支持多条评论置顶。置顶的评论列表中按照“最新置顶时间在最前”进行排序；支持评论取消置顶。取消置顶后，该评论从置顶区消失，非置顶区按照createTime重新排列；补充说明：发布官方及高权限者可以置顶和删除所有评论，可以取消置顶所有已置顶的评论；发布客方只可以置顶自己发出的评论，只可以取消置顶自己发出的已置顶的评论；可以删除自己发出的评论；非发布官客方可以评论和删除自己的评论，但不支持置顶；只能置顶一级评论，置顶后该评论及其回复一同置顶，对评论的回复不支持单独置顶；参考文档：       三、视觉设计web端设计稿：  移动端设计稿：  四、待解决问题高等级用户也可以置顶评论——依赖会员等级服务的需求确认；现有web端系统中发布评论和首页动态评论的样式需要保持一致；web首页动态设计稿：  现有移动端的发布评论在详情最下面，设计稿已更新，开发还没做；数据结构统一为动态和发布评论以及回复的字数限制都为140字；有评论置顶后，所有发布官方会收到系统通知，通知内容为：    “产品研发-张瑞 在 xxxxxxxxx发布下 置顶了评论 xxxxxxxxx ”
测试一个发布问题: 阿基飞机哦电视剧噶时光机哦啊感觉都 i  
多人协同发布编辑需求: 设计图-web：https://lanhuapp.com/web/#/item/project/board?pid=f49729e2-f1f1-4896-87a8-5fbaa49ecd2b设计图-移动端：https://lanhuapp.com/web/#/item/project/board?pid=e64a14e0-a7b6-4c7a-85d2-ea9c322e4f551. 版本记录2. 需求参与者信息3. 关联需求信息多人协同发布编辑技术方案 语雀调研以及和发布的比较
4. 功能说明：4.1.1 功能简述：对于编辑发布，增加多人协同编辑功能。用户故事：目前在多人同时编辑发布时，缺少系统控制，仅在保存时会提示有冲突，结果会造成仅有一人编辑的内容保存成功，那么现在需要优化成，能够在编辑发布前及时知晓有别人在编辑，或者允许多人协同编辑发布，具体采用哪种形式，在该发布的属性中选择。功能详述：优先级：高平台：WEB、APP。描述：1. 在创建发布和编辑发布时，增加一个字段“协同编辑形式”，下拉选则“不允许多人同时编辑”“允许多人同时编辑”，默认“不允许”； 2. 当高权限者点击“编辑发布”时，即加入发布，成为官方；如果遇到有别人占用发布编辑，在会话发出后，会加入发布，成为官方；3-1. “不允许（对应技术方案的方案一，整个发布加锁）”的情况下，当A在编辑发布时，其他人再点击“编辑发布”时，系统弹出提示：“发布正被XX角色 XX用户编辑中，请稍后重试”，如果选择“继续等待”，那么仅关闭弹窗；如果选择“发起会话”，那么会先关闭此弹窗，然后弹出此发布的官方会话，且在准备发送的会话内容中写入“@XX角色 XX用户”，然后由用户进行后续动作；直到A保存发布或退出发布后，其他人才可编辑发布；允许同一个角色多次进入同一个发布，且每个编辑页在同一时间，看到的内容要一致；后端校准前端的频率是：在有变化的情况下，一分钟校准一次； 请注意遵循角色显示规则 ： 3-2. “允许（对应技术方案的方案四，按段落识别版本）”的情况下，当A在编辑发布时，其他人也可编辑发布；系统设置同时进行发布编辑的人数上限值为5，当第6个人想要编辑发布时，系统弹出提示：“协同编辑人数已达上限，请稍后重试”，如果选择“继续等待”，那么仅关闭弹窗；如果选择“发起会话”，那么会先关闭此弹窗，然后弹出此发布的官方会话，且在准备发送的会话内容中写入“@XX角色 XX用户 @XX角色 XX用户 @XX角色 XX用户 @XX角色 XX用户 @XX角色 XX用户”，然后由用户进行后续动作；注意此处的人数不是按照账号数量，而是按照进入发布的人次数量，即，如果一个账号同时打开多个tab页，每个都进入了同一个发布编辑页，那么每开一页，计数就+1；每个编辑页在同一时间，看到的内容要一致；后端校准前端的频率是：在有变化的情况下，一分钟校准一次； 4. 关于保活时长，以及用户退出编辑页面后，再次进入的场景：保活时长：15分钟，动作包含：修改发布内容、滚动查看、移动光标、选中部分内容，假设起始版本是V0，独占：当用户在编辑的过程中，系统会持续保存当前最新的草稿；当用户点击“保存编辑”时，将生成版本V1，同时删除草稿，然后用户会退出编辑页面；当用户点击右上角的“X”时，将保存当前最新的草稿；当用户停留在编辑页面，连续15分钟没有动作发生，系统会把他强制退出编辑页面，同时弹出提示：“因为您长时间未操作编辑，现已退出”，同时保存当前最新的草稿；再次进入时，系统将提示“有未保存的版本，是否恢复”，然后根据用户的选择，进入草稿或者V0，如果用户选择进入V0，那么就删除原草稿，然后开始记录新的草稿；当用户在编辑过程中关闭浏览器，若15分钟内再次进入，将直接进入当前最新的草稿；若超出15分钟没有进入，系统会把他强制退出发布编辑，不弹提示，同时保存当前最新的草稿；再次进入时，系统将提示“有未保存的版本，是否恢复”，然后根据用户的选择，进入草稿或者V0，如果用户选择进入V0，那么就删除原草稿，然后开始记录新的草稿；当用户在编辑过程中断开连接，若15分钟内再次进入，将直接进入当前最新的草稿；若超出15分钟没有进入，系统会把他强制退出发布编辑，此时不弹提示，同时保存当前最新的草稿，在恢复网络连接后，会引发弹出提示：“因为您长时间未操作编辑，现已退出”；再次进入时，系统将提示“您有未保存的版本，是否恢复”，然后根据用户的选择，进入草稿或者V0，如果用户选择进入V0，那么就删除原草稿，然后开始记录新的草稿；协同：当用户在编辑的过程中，系统会持续保存当前最新的草稿（多人在线时，大家存的是同一份草稿）；当任一用户点击“保存编辑”时，都将生成新的版本，一旦有一个人点击了保存，将生成版本V1，同时删除原草稿，然后此用户会退出编辑页面，之后系统开始在V1基础上记录新的草稿，此时同处于协同编辑中的其他人将同时接收到屏幕底部通知“XX角色 XX用户已保存了此次编辑”，然后各自继续在最新草稿上编辑发布；当任一用户点击右上角的“X”时，将保存最新的草稿，然后此用户会退出编辑页面；当某个用户停留在编辑页面，连续15分钟没有动作发生，系统会把他强制退出编辑页面，同时弹出提示：“因为您长时间未操作编辑，现已退出”，同时保存当前最新的草稿；再次进入时，无论哪个用户，如果没有草稿，就会进入最新的版本；如果有草稿，且不是系统强制退出时保存的，就会进入最新的草稿；如果有草稿，且是系统强制退出时保存的，系统将提示“有未保存的版本，是否恢复”；当某用户在编辑过程中关闭浏览器，若15分钟内再次进入，将直接进入当前最新的草稿；若超出15分钟没有进入，系统会把他强制退出发布编辑，不弹提示，同时保存当前最新的草稿；再次进入时，无论哪个用户，如果没有草稿，就会进入最新的版本；如果有草稿，且不是系统强制退出时保存的，就会进入最新的草稿；如果有草稿，且是系统强制退出时保存的，系统将提示“有未保存的版本，是否恢复”；当某用户在编辑过程中断开连接，若15分钟内再次进入，将直接进入当前最新的草稿；若超出15分钟没有进入，系统会把他强制退出发布编辑，此时不弹提示，同时保存当前最新的草稿，在恢复网络连接后，会引发弹出提示：“因为您长时间未操作编辑，现已退出”；再次进入时，无论哪个用户如果没有草稿，就会进入最新的版本；如果有草稿，且不是系统强制退出时保存的，就会进入最新的草稿；如果有草稿，且是系统强制退出时保存的，系统将提示“有未保存的版本，是否恢复”；   补充：目前，只对发布内容做协同编辑控制，对于发布附件不做协同编辑控制。正式发布后的“草稿”，实际是缓存，会在最后一次编辑后存在24小时，之后会删除。

发布-发布写冲突处理（待评）: 目标：目前当大于1人同时编辑同一个发布时，会在最终提交时发生冲突，造成内容丢失。为避免此类情况发生，提升用户体验，此次将把发布的编辑功能优化，避免冲突发生。功能描述：1. 在一个用户对某个发布触发了“编辑”操作的同时，系统将控制此发布不可再被触发“编辑”操作，直到这个用户“保存”或“取消”了此次编辑为止；2. 如果在此期间有第二个用户点击了“编辑”按钮，系统将会提示“发布正被某某某（盟-事务-角色 姓名）编辑，请稍后再试”。用户可点击角色与之发起会话，用于提醒对方尽快释放发布；3. 一名用户在编辑发布的状态下，停止操作30分钟，系统将使其自动退出。
