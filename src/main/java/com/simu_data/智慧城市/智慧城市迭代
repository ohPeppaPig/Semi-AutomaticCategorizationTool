 紫色字体为暂时不管的内容一、综述1.1 背景针对智慧城市验收时候提出的问题进行设计改进针对切换城市时候出现的问题进行跟进1.2 命名 1.3 名词解释 1.4 影响范围本次迭代只设计智慧城市里面的内容1.5概述 二、详细需求设计图2.1 智慧城市按钮每次进入智慧城市，除路线功能外，其余reset重回初始态如果已经在智慧城市页面，再次点击智慧城市按钮则回到智慧城市首页。2.2 快捷工具栏和名胜景点添加“更多”按钮样式样式模样与“我的”一致，少于四个（含四个）为fix，多于4个可左右滑动大于8个时候显示更多2.2.1 常去地点命名统一为地点收藏，包括功能页、以及编辑页面字数太长时用...表示每个机型能显示字数上限不一，如果没法确定什么时候会太长，则字数显示上限为8个字无数据时显示如果用户没有数据时，添加一个“添加地址+”按钮当存在1个或以上时，添加地址按钮消失点击添加地址+时直接跳到地理位置选择器点击管理后经常访问列表添加滑动条 2.3 其他右上角切换城市需要一个遮照，方便用户点击和辨认在智慧城市主界面如果滑动屏幕，则将功能页自动收起将三级那个弄回来，提高整体使用流畅度收起界面内容需要枚举空隙太大城市宝藏、悬赏、城市剧情弄回黑色，图标还在设计。 2.4 个人放大个人聚合图标，如果和用户重合则在当前屏幕上偏移到不重合bug修复：部分机型底栏和关闭按钮重合。需要统一的内容设计图在右上，线上在中间下方，关闭按钮统一到右上方点击头像+名字+个人简介后进入个人主页，个人主页后退返回该列表bug和交互/做整合交互移动端会话图标、工作台会话图标，左栏web端会话图标，智慧城市会话图标 三、功能页面内容增大扫码按钮可以接近顶到搜索栏边界对应热区在图标大小情况下，再增大2px3.1 功能页面交互调整命名：功能页面收缩，功能页面初始，功能页面伸展功能页面收缩与伸展展示程度的互换，在上拉下拉的操作下新增需要一个从收起样式跳过初始态到展开样式，这么一个一级直接到三级，三级直接到一级的操作3.2 切换城市列表列表中的ABCD的列表小Title需要置灰a-z定位，顶部“区县定位”手指时能滑动到区县定位手指在滑动状态未离手的情况下到了区县定位更上方，则回到顶部3.3 加油站、美食文化、共享雨伞等内容 按钮和标题做一个mask打底（需要设计）列表需要增加显示地址，如果是高德获取数据则高德内容自持数据则为为路+门牌号地图上加油站暂不显示名字，图标可以稍微小1-2px列表需要一个滑动栏在列表右边用户如果在列表顶部往下滑动，则列表收起到底部用户如果在地图滑动，则收起列表列表顶部向上滑动则出现全页面3.4 显示设置添加文案隐身设置：选择自己地理位置展示方式筛选设置：在地图上选择是否显示该内容间距不统一3.5 技术相关 GPS权限问题有用户反应一开始用户GPS定位关闭，给予之后无法及时刷新数据，必须退出app重新进入才可以，这个有没有办法改进到能感知到用户已经授权并且刷新？@sbj四、切换城市操作主要为了满足以下场景 点击快捷功能栏内容是以中心点为距离从近到远显示的内容名胜景点是显示为中心点根据距离排序从近到远周围的内容，并且根据中心点变化重新排序而经常访问属于固定内容，属于收藏栏，不以城市变化或者中心点变化而变化的内容二三类合并。需要一个阈值4.1 初始态样式：头像在屏幕的正中央，切换城市显示的是当前GPS所在的城市初始态触发条件：点击进入智慧城市后；点击用户GPS当前所在城市（即包括GPS定位以及历史城市）4.2 中心点操作4.2.1 用户默认中心点同城时默认用户GPS位置为原点同城时默认中心点不用显示大头针，切换异地后默认以市中心作为标记点。4.2.2 自定义标记点设立与变更用户在智慧城市主界面对地图长按1.5s（不一定真的要这个秒数）， 即将标记点确定到该点，该样式需要特别样式一点。因为这种操作比较隐蔽，所以需要操作提示。新手引导，进入智慧城市提醒一次。需要定义规范，每个地方新手引导不一样，主系统：滑屏，有三四套，需要统一。需要有归档记录，例子：功能都没有了但是新手有。需要档案管理。（重要）自定义标记点后会出现标记点卡片，此时会替代搜索栏，原有搜索栏会向下收起隐藏用户自定义标记点出现后，直接弹出卡片，卡片为两级抽屉，可通过上下拉实现收起与展开。标记点为后端定义的点，即标记点和自己/城市中心点可以出现在同一个屏幕，只是此时的计算等内容都是围绕自定义标记点进行 卡片点击卡片外关闭卡片内容显示的和主功能里面内容一致加油站等内容搜索该点附近加油站名胜景点显示当前城市的名胜景点，按照与标记点距离从近到远排序该页面可上下滚动，继续往下滚动会变成全页面，方便后续添加城市剧情（后续迭代）现在最近剧情位置放置（敬请期待）自定义标记点如果在二级界面上变更，会关闭二级界面，回到系统主界面如我打开加油站，然后长按屏幕，会回到主界面然后出现标记点卡片4.2.3 取消自定义标记点在智慧城市主界面再次点击标记点点marker以外的地方，标记点marker消失，卡片消失此时中心点返回默认用户离开智慧城市切换到其他页面时，自定义标记点清空用户点击定位点时，中心点回到用户GPS所在城市的GPS位置4.2.4 根据标记点切换城市如果用户点击的标记点不在右上角（切换城市）的行政区域则出现toast提示：“已为您切换到[城市名]”，并且右上角显示当前标记点所在城市。此时切换后的城市中心点已经由默认变成用户设定的标记点同时要出现用户自定义标记点后的卡片4.3 显示内容4.3.1 基础显示内容确定中心点后就变化的：名胜景点，名胜景点根据中心点排序。点击后根据中心点搜索结果变化：美食文化、加油站、雨伞服务，搜索，都以中心点点为圆心进行设定半径的搜索结果如果当前搜索半径没有结果，直接出现toast提示“找不到周边的[模块名称]”如果当前半径搜索结果为0，则增大搜索半径（比例尺应该比较固定）如果这个增加搜索半径需要产品定的话，每次搜索半径可能做成配置项体验比较好调整当前设定为：5KM，1为什么500KM，因为重庆作为最大的城市单位，东西范围有470KM。。。。如果当前匹配内容多于10个，距离最近的前10个结果进行适配即列表可以有多于十个，但是marker不用显示多于10个搜索结果的marker在屏幕上表示，并且屏幕能进行自适应调整分辨率。4.3.2 点击功能后移动屏幕显示内容当用户GPS点/标记点不在屏幕范围内时，触发以地图中心刷新机制。刷新方式：在划动地图后松手，原有结果清除，根据当前屏幕中心点进行搜索划动过程一直未松手前，就维持原有结果，不进行搜索搜索方式：根据当前屏幕中心点，以3KM作为搜索半径进行内容搜索。地图缩放不影响该搜索半径。如果3KM内无搜索结果，则toast提示“找不到周边的[模块名称]”如果当前屏幕中心点超过用户GPS点/标记点20KM，则显示“太远了，够不着”4.4 城市列表与智慧城市维持现状五、显示距离与路线5.1 距离显示显示的是中心点的距离如果是用户GPS为中心，显示“距您xxx km”如果是用户自定义标记点，显示“距标记点 xxx km”5.2 路线显示当前以用户的GPS为起点地址显示路线，其他内容后续迭代六、距离与比例尺需要显示比例尺控件，在左下方，这样后续好调整在单机加油站、美食文化、雨伞的情况下，内容根据范围搜索然后根据前排名前十的内容，做一个marker屏幕比例尺自适应点开上述内容后移动屏幕，则按照用户当前使用比例尺，做成搜索配置，以比例尺对应搜索半径进行搜索。原则：当前比例尺时候，从屏幕中央搜索按照当前比例进行配比。比例尺大于左边范围时，使用右边对应搜索半径 经常访问、路线、导航再下一波迭代迭上去已删除内容屏幕在当前位置点击显示初始态时点击自己的城市内容都会从自己的GPS地点为中心向外扩散初始态移动后点击则回到用户GPS点为中心点屏幕在数据结果的位置移动方案1，如果用户GPS地址在屏幕外，则出现从中心点开始搜索按钮，并且出现大头针在屏幕正中间问题：体验不流畅，没数据时只能出现一个toast“当前位置无数据”优点：不用一直根据用户屏幕移动而进行描绘方案2，不出现按钮，直接自动搜索，大头针出现在屏幕正中间问题：会显得卡顿和慢优点：操作体验上比较流畅屏幕在当前位置没数据又点击时点击后等于屏幕中心打下大头针，然后向外进行搜索。以同心圆为距离向外缩小比例尺，以求保证搜索结果都在内容里面有需要的话，我手动定义比例尺屏幕点击后没数据时直接内容不显示，不显示补齐屏幕中心点在城市区域边界时点击方案1：直接切换成其他城市点击后显示当前中心点周边内容方案2：询问后切换同意切换则切换到其他城市显示当前中心点周边内容不同意则不切换到其他城市并且不显示其他城市内容点击后移动到当前城市以外区域不显示内容5.2 切换城市后直接点右上角切换城市（如果不是自己GPS所在城市），会前往切换后城市的中心点。该中心点出现大头针，示意用户逻辑计算从该点出发，再次点击屏幕会使大头针消失屏幕在切换城市后直接点击直接点击则根据大头针的显示位置为圆心进行周边搜索切换城市后、取消大头针、移动点击则移动后的屏幕中心点立下大头针为圆心进行周边搜索换城市后无数据如果当前城市存在数据则缩小比例尺，显示相对位置如果整个城市都没有数据则出现toast切换城市后显示数据后移动情况如5.1位置移动到达城市边界时显示情况如5.1 需要确认经常访问