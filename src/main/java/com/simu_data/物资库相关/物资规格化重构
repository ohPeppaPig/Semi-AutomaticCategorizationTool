文档变更记录 一、需求背景 & 目标1、目前物资模板存在的问题：     在领域模型层面，物资模板的归属存在问题。目前，创建物资模板的入口在具体的某个仓库中，且没有统一的维护入口。而物资模板作为描述一个产品/物料的一组数据，对于一个盟或事务而言，在整个物资模块拥有一个入口进行维护更为合理。    物资模板的定义存在模糊。目前在业界的实践中（电商的商品管理系统、库存系统等），通常会引入spu和sku的概念（spu和sku的概念见背景知识），即标准产品单元和库存单元。而目前超级账号的物资模板其实是“用户自定义的分类和该分类下的属性名”。2、相关背景知识：     spu与sku：https://www.cnblogs.com/lingyejun/p/9569563.html     后台分类和前台分类：《淘宝十年产品事》 第二章     国家统计局标准产品分类：http://www.stats.gov.cn/tjsj/tjbz/tjypflml/二、需求影响范围产品模板：物资模板重构、库存、商品相关服务（上架、套餐、定价）、交易（发出/收到物资）、采购。想到再补充 三、领域模型 名词解释 四、需求描述 & 低保真原型 4.1 物资模板相关     物资模板的概念： 一组描述商品特性的可复用的、标准化的易检索的数据集合。从业界常用的spu、sku概念来看，超级账号的物资模板概念是spu。  4.1.1 物资模板维护入口：物资模板维护提高到和事务物资库并列的层级，事务下资源-->物资-->管理物资模板 4.1.2 物资模板的创建：在管理物资模板的模块，可以进行新建物资模板的操作。有两种方式新建物资，直接新建或在现有的物资模板上新建  注：每个事务都可以查看本盟下所有的物资模板，但是创建、编辑、失效的权限需要进行控制直接新建需要输入的信息包括：基础信息部分：主图，非必填，同目前新建物资模板上传主图的需求 *名称（必填），支持中英文，不超过64字符；同一个事务下创建的模板名称不可相同别名：支持中英文，规则与约束与系统现行保持一致*单位：必填，系统预置单位选择的范围，用户从系统预置中选择一个计量单位。预置的单位选择范围同目前物资模板的单位选择范围，支持搜索单位名称*建议零售价：必填，大于0，支持到小数点后两位，小于等于integer.max*分类，必填，需要支持即时搜索，即用户在输入分类时自动根据关键词推荐全网已有的分类名称，按匹配度由高到低排序；无搜索结果时，系统在该模版创建成功时自动新建用户输入的分类；分类名称不超过8个字符。        //todo  创建模板时选择的分类实际上是系统分类，系统分类是用户自维护的平铺的分类系统还是预置一套标准分类系统供用户选择属性及属性值：一组描述该物资模板的key-value，分为普通属性和时间属性，普通属性包括：    属性名称：即key，支持中英文，不超过8个字符    属性值：即value，包括文本属性值和统计属性值，区别在于定义属性值时选不选单位；对于文本属         性值，不得超过20个字符；对于统计属性值，支持的单位范围和目前系统保持一 致，同时输入的           属性值只能为数字，数字不得超过float.max；一个物资模板最多支持20个key-value的添加  时间属性即目前系统中物资模板上的时间管理器*是否公开：默认打开，打开后全网即可搜索并购买该模板的授权，模版的公开性不区分盟内盟外。选择公开后可以为模版定价。在定价为0的情况下，需申请授权审批；在定价不为0的情况下，可通过付费直接购买（目前只支持支付盟客币购买）。如何购买授权见下文标签（非必填），可在模板中添加多个标签，同目前物资模板的添加标签功能规格：包含规格名和规格值，规格名和规格值不得超过8字符，一个物资模板不得制定超过三种规格，一个规格下不得超过20个规格值。规格对确定sku、生产规则的制定、采购、库存、销售都有重要影响。图文详情：一段富文本，富文本的功能、约束和限制与系统目前的普通发布富文本保持一致。 生产规则部分定义生产该物资需要的原料 & 各原料需要的数量。对于有多规格的物资，生产规则实际定义了一组sku的原料以及原料用量新建生产规则的需要定义的信息包括：      *产量：必填，定义此生产规则可以产生多少产物       *生产规则名称，必填，文本，不得超过20个字符，不可为空      *公开性：必填，可选择公开、私密、选择性公开；选择性公开中可以选择盟内公开、事务内公开和自定义（此部分复用发布的公开性）；公开性影响 1、可见性，未对其公开的角色不可查看；2、复用。未对其公开的事务复用模板时不可复用该生产规则；复用模板见文档下文。 若物资模板为私密，则该物资下的所有生产规则都不能为公开或部分公开。      //tbd：公开性带来的复杂度成指数上升，在系统物资模块目前的使用状态下，成本大于收益，此处可以考虑简化      对应的规格值： 即此生产规则所对应的sku，要求每个规格名下选定一个规格值         *原料表：一组原料和原料的用量，不超过30种。原料即除产物本身的其他物资模板的sku。选择原料需要支持关键字搜索，搜索范围包括： 盟内已有的物资模板、盟外公开的物资模板。在原料有规格的情况下，选定原料时需要指定到该原料的规格      在生产规则的配置中，有必要表示规格和规格之间的关系，举例：某种物资有三种规格，分量：大/中/小， 口味：甜/辣， 做法：清蒸/红烧，甜的规格需要增加糖的原料，同时对于大/中/小份的规格，所用的糖的份量有所不同 从系统已有模板创建：除直接从头创建一个物资模板外，支持从系统中选取一个已经存在的物资模板为基础进行重新创建。可以理解为从系统中搜索一个差不多的模板，以此为基础改一改变成自己的模板  1、搜索已有物资模板的方式：关键字搜索，搜索范围包括：本盟创建的所有物资模板（不包括失效的物资模板）、盟外的公开的物资模板。搜索后可查看基础信息（即除了生产规则之外的信息）  2、在确定要复用的物资模板的基础上，支持对复用的物资模板的所有基础信息进行变更，字段的规范以及约束和直接新建模板保持一致3、修改后创建新的物资模板，新物资模板归属为当前盟。4、除复制外，通过关键词搜索到的盟外物资模板，可以通过申请授权或者直接购买的方式直接获得盟外模板的使用权。对于没有定价的物资模块，需要申请授权，对于定价的物资模板，支付定价获得使用权    创建物资模板的审批：      事务下的物资高级权限可以创建物资模板，根据审批配置发送给审批者（此处需要加创建物资模板的审批配置），审批者可查看物资模板的内容，审批成功后即创建物资模板成功。物资模板的编辑与失效：  4.2 库存相关物资库中记录了事务下的物料/产品库存，并支持相关角色对物料/产品的库存进行操作和管理。在物资模板进行规格化后，物资的库存部分需要进行相应调整。4.2.1 仓库调整 1、去除事务下的全网公开库和盟内公开库。考虑创建事务时会默认创建三个物资库，全网公开库、盟内公开库，目前三个库在系统中几乎没有用户使用（基本会根据需要自定义库），且目前产品主要通过服务进行交易或者转移，全网公开库和盟内公开库存在的意义不大，反而会带来冗余，因此考虑去除全网公开物资库和盟内公开物资库。2、物资库的公开性问题。似乎也没有存在的必要，考虑去除。4.2.2 库存操作直接登记产品     系统支持两种直接登记物资的方式：直接在已有库存中追加物资，或者在没有库存情况下选择物资模板进行入库登记。     登记物资需要输入的信息包括：        入库商品的物资模板(spu)，对于追加库存的登记，物资模板即需要追加的商品；支持全网搜索公开的物资模板进行登记入库。        商品规格：即登记入库时需要确定该批次对应的sku        入库数量：支持到小数点后两位             入库总价：即这批入库单品的总价，支持到小数点后两位，便于计算物料成本和做销售定价参考。        所在位置：这批物料所在的位置卡片，选择范围为事务下管理的位置卡片        备注：文本，对入库物料批次的简单备注说明，不超过200个字符 核销、报废、拆分：这三个操作只能针对已经有库存的物料进行操作，此部分需求不做变更。生产产品    约束和限制：     只能生产本盟所有的物资和被授权的物资     暂不支持一次选定多个spu进行生产，但可以支持一次选择多个sku进行生产    与登记产品类似，支持两种方式，对于有库存的产品，可以直接进行生产；在没有库存的情况下，可以选择盟内的物资模板进行生产。          生产时需要输入的信息字段包括：     物资模板 & 规格：即确定要生产的sku。支持一次生产一个spu下的多个sku     产量：即指定需要生产多少。在生产多sku的情况下，支持为不同的sku确定对应的产量     生产规则：选用具体的生产规则，没有生产规则的情况下，不可直接生产      在产物、产量以及生产规则确定后，系统需要自动计算出需要消耗的原材料，并按先进先出的原则消耗原材料批次，同时支持用户调整需消耗的原材料批次。在原材料不足的情况下不可执行生产，并需要做提醒，提醒信息见原型图。     负责人：需要指定本次生产的负责人，选择范围为当前事务下的所有角色。发起生产后，负责人会收到生产任务，同时系统锁定本次生产的原料。在负责人点击提交生产任务时，系统生成产物并入库，同时消耗原材料。  4.2.3 库存展示：   单个库的库存概览      提供两种展示视图：缩略（卡片）视图和列表视图。      卡片视图展示的内容包括：      物资模板主图、物资模版名称、规格以及规格值、库存量、评价数&评价详情、   入库均价以及入库价格走势                       库存详情展示，展示信息包括：            库存批次总量、锁定量、入库时间、库存id、规格值（即表明是哪个sku的库存）、入库总价/单价、所在位置（即登记时选择的位置卡片），备注信息。      4.2.4 库存记录 & 动态物资模板进行规格化重构后，系统中会存在四种粒度的物资动态记录，包括1、事务物资模块整体动态记录   2、单个物资库动态记录     3、单个物资库下单个spu动态记录：4、单个库存批次动态记录对于这4中物资动态记录，在记录信息中需要增加规格信息，以单个库的物资记录为例，需要增加规格字段，其他几种记录类似，此处文档篇幅所限，不做赘述。 4.3  关联需求变更：4.3.1 商品相关服务上架商品：整体逻辑和原来并无太大变更，即确定上架时间、上架产品以及上架数量。在有规格的情况下，可以支持按规格上架和按总量上架。上架时商品的筛选和查找和搜索：     确定前台维度，前台维度确定可查看分组下的物资模板，选择相应的物资模板后确定上架数量和出品库（出品库决定物资从哪个库出库）；对于没有定价的物资可以直接定价；选择出品库时可查看库存； 支持套餐和单品的筛选；支持物资名的搜索；对于套餐的上架，不需要选择出品库    按规格上架 & 按总量上架：    对于有多个sku的产品，可以分规格上架，即确定每种规格的各自上架数量；同时支持按总量上架，即所有sku共享上架数量。    对于按规格上架的物资，如果该规格已经无法销售（即售出量 + 锁定量）=  出品量，则用户无法选择该规格；对于按总量上架的物资，只要所有规格的售出量+锁定量 < 出品量，则所有的规格都可以销售，直至所有的规格售出量 +锁定量 = 出品量         切换生产规则：  上架后可以切换生产规则，同时确定生产规则的负责人。注：现有的生产规则，实际上定义了一个spu下多个sku生产规则。因此在上架切换规则时，分以下几种情况：   1、有sku，只可在spu层进行生产规则的切换；   2、没有sku，等同于只有一个sku的spu，也只能在spu层进行生产规则的切换；   3、套餐，较为特殊，套餐下的单品是sku，可以切换生产规则。此处要注意可能某一个生产规则没有包含该规格的原料，此种情况系统支持选择，只是生产时不做库存的扣减定价  规格化重构后，需要更新对有规格的物资的定价方式。对于有规格的物资，在服务的定价模块，套餐4.3.2 相关服务的菜单页和订单页          对于有规格的商品，需要在菜单页面提供规格选择，同时体现在订单页面以及线下纸质订单（小票）美团外卖菜单页 & 订单页以供参考：   4.3.2 交易记录物资交易详情记录中需要增加规格信息 4.3.3 出品计划&采购                 